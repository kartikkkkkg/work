import React, { useState, useEffect } from 'react';
import { BrowserRouter, Routes, Route, useNavigate } from 'react-router-dom';

import NavBar from './components/NavBar';
import HomePage from './components/HomePage';
import CustomersPage from './components/customers/CustomersPage';
import CustomerDetailsPage from './components/customers/CustomerDetailsPage';
import CustomerFormPage from './components/customers/CustomerFormPage';
import NotFoundPage from './components/NotFoundPage'; // A simple 404 page

import customersData from './customers.json'; // Your mock data
import './App.css'; // Your main CSS

const App = () => {
  const [customers, setCustomers] = useState([]);

  useEffect(() => {
    // Load initial data from JSON
    setCustomers(customersData);
  }, []);

  // Handler for adding a new customer
  const handleAddCustomer = (newCustomer) => {
    const newId = customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1;
    const customerWithId = { ...newCustomer, id: newId };
    setCustomers([...customers, customerWithId]);
  };

  // Handler for updating an existing customer
  const handleEditCustomer = (updatedCustomer) => {
    const newCustomers = customers.map(c => 
      c.id === updatedCustomer.id ? updatedCustomer : c
    );
    setCustomers(newCustomers);
  };

  // Handler for deleting a customer
  const handleDeleteCustomer = (customerId) => {
    const newCustomers = customers.filter(c => c.id !== customerId);
    setCustomers(newCustomers);
  };

  return (
    <BrowserRouter>
      <div className="App">
        <NavBar />
        
        <main className="content-container">
          <Routes>
            <Route path="/" element={<HomePage />} />
            
            {/* The Customers List Page with CRUD actions */}
            <Route 
              path="/customers" 
              element={
                <CustomersPage 
                  customers={customers} 
                  onDelete={handleDeleteCustomer} 
                />
              } 
            />

            {/* The Customer Details Page */}
            <Route 
              path="/customers/:id" 
              element={
                <CustomerDetailsPage customers={customers} />
              } 
            />

            {/* The Customer Form Page for creating or editing */}
            <Route 
              path="/customers/add" 
              element={
                <CustomerFormPage 
                  onSave={handleAddCustomer} 
                  mode="add" 
                />
              } 
            />
            <Route 
              path="/customers/edit/:id" 
              element={
                <CustomerFormPage 
                  customers={customers}
                  onSave={handleEditCustomer} 
                  mode="edit" 
                />
              } 
            />

            {/* A catch-all route for unmatched paths */}
            <Route path="*" element={<NotFoundPage />} />
          </Routes>
        </main>
      </div>
    </BrowserRouter>
  );
};

export default App;
